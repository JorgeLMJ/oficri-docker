<div class="container-fluid p-0 animate-in fade-in duration-500" style="height: calc(100vh - 65px); overflow: hidden; background-color: #f8fafc;">
  
  <div class="p-4 overflow-y-auto h-100 custom-scrollbar">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
      <button class="bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-2.5 rounded-xl shadow-lg shadow-emerald-200 transition-all flex items-center font-black text-xs uppercase tracking-widest border-0" 
              (click)="abrirModalNuevo()">
        <i class="bi bi-person-plus me-2 text-lg"></i> Nuevo Empleado
      </button>

      <div class="text-end">
        <h2 class="text-primary font-black tracking-tight mb-0">
          GESTIÓN DE EMPLEADOS <i class="bi bi-person-badge ms-2"></i>
        </h2>
        <p class="text-muted small mb-0 font-medium">Administración central de personal - Cusco</p>
      </div>
    </div>

    <section class="mb-4">
      <div class="input-group shadow-sm rounded-2xl overflow-hidden border border-slate-200 bg-white group focus-within:ring-2 focus-within:ring-primary/20 transition-all">
        <span class="input-group-text bg-white border-0 ps-4">
          <i class="bi bi-search text-slate-400 group-focus-within:text-primary"></i>
        </span>
        <input type="text" class="form-control border-0 py-3 text-sm font-medium focus:ring-0 shadow-none bg-white" 
               placeholder="Buscar por nombre, apellido, DNI..." [(ngModel)]="searchTerm" (input)="goToPage(1)">
        <span class="input-group-text bg-white border-0 pe-4">
          <span class="badge bg-slate-100 text-slate-500 rounded-pill font-black text-[10px]">
            {{ filteredEmpleados.length }} TOTAL
          </span>
        </span>
      </div>
    </section>

    <div class="table-responsive shadow-sm rounded-3xl border d-none d-md-block bg-white overflow-hidden">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-slate-50 border-bottom">
          <tr class="text-black">
            <th class="ps-4 py-3 text-[11px] font-black uppercase tracking-widest">ID</th>
            <th class="py-3 text-[11px] font-black uppercase tracking-widest">Empleado</th>
            <th class="py-3 text-[11px] font-black uppercase tracking-widest text-center">DNI</th>
            <th class="py-3 text-[11px] font-black uppercase tracking-widest text-center">Cargo</th>
            <th class="py-3 text-[11px] font-black uppercase tracking-widest text-center">Estado</th>
            <th class="pe-4 py-3 text-[11px] font-black uppercase tracking-widest text-end">Acciones</th>
          </tr>
        </thead>
        <tbody class="text-sm">
          <tr *ngFor="let emp of paginatedEmpleados; trackBy: trackById" class="hover:bg-blue-50/40 border-bottom border-slate-100 transition-colors">
            <td class="ps-4 font-bold text-slate-400">#{{ emp.id }}</td>
            <td>
              <div class="d-flex align-items-center">
                <div class="h-9 w-9 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center font-black text-xs me-3 border border-blue-200">
                  {{ emp.nombre.charAt(0).toUpperCase() }}
                </div>
                <div>
                  <div class="font-bold text-slate-700 leading-tight">{{ emp.nombre }} {{ emp.apellido }}</div>
                  <div class="text-[10px] text-muted">{{ emp.usuarioEmail || 'Sin vínculo' }}</div>
                </div>
              </div>
            </td>
            <td class="text-center font-mono font-bold text-slate-600">{{ emp.dni }}</td>
            <td class="text-center">
              <span class="px-3 py-1 rounded-lg text-[10px] font-black bg-slate-100 text-slate-600 border border-slate-200 uppercase">{{ emp.cargo }}</span>
            </td>
            <td class="text-center">
              <div class="form-check form-switch d-inline-block">
                <input class="form-check-input" type="checkbox" [checked]="emp.estado === 'Activo'" (change)="toggleEstado(emp, $event)">
              </div>
            </td>
            <td class="pe-4 text-end">
              <div class="d-flex justify-content-end gap-1">
                <button (click)="editarEmpleado(emp.id!)" class="p-2 text-amber-500 hover:bg-amber-50 rounded-xl transition-all border-0 bg-transparent"><i class="bi bi-pencil-square"></i></button>
                <button (click)="confirmDelete(emp)" class="p-2 text-red-500 hover:bg-red-50 rounded-xl transition-all border-0 bg-transparent"><i class="bi bi-trash"></i></button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-center mt-4">
      <nav class="bg-white p-1 rounded-2xl shadow-xl border border-slate-100">
        <ul class="pagination mb-0 border-0 gap-1">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link border-0 rounded-xl w-10 h-10 d-flex align-items-center justify-center transition-all hover:bg-slate-100" (click)="prevPage()">
              <i class="bi bi-chevron-left text-primary"></i>
            </button>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
            <button class="page-link border-0 rounded-xl w-10 h-10 d-flex align-items-center justify-center font-black transition-all" 
                    [ngClass]="page === currentPage ? 'bg-primary text-white shadow-md shadow-primary/30' : 'text-slate-500 hover:bg-slate-50'" 
                    (click)="goToPage(page)">
              {{ page }}
            </button>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link border-0 rounded-xl w-10 h-10 d-flex align-items-center justify-center transition-all hover:bg-slate-100" (click)="nextPage()">
              <i class="bi bi-chevron-right text-primary"></i>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<div class="modal fade" id="empleadoModal" tabindex="-1" data-bs-backdrop="static">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-2xl rounded-[2rem] overflow-hidden">
      <div class="modal-header bg-primary text-white p-4 border-0">
        <h5 class="modal-title font-black uppercase tracking-tight">
          <i class="bi bi-person-badge-fill me-2"></i> {{ editMode ? 'Editar' : 'Nuevo' }} Empleado
        </h5>
        <button type="button" class="btn-close btn-close-white shadow-none" (click)="cerrarTodo()"></button>
      </div>
      <div class="modal-body p-4 bg-slate-50">
        <form [formGroup]="empleadoForm" (ngSubmit)="guardarEmpleado()">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="text-[10px] font-black text-slate-400 uppercase mb-2 d-block ms-1">Nombres</label>
              <input type="text" class="form-control rounded-xl border-slate-200 py-2.5 font-bold shadow-sm" formControlName="nombre">
            </div>
            <div class="col-md-6">
              <label class="text-[10px] font-black text-slate-400 uppercase mb-2 d-block ms-1">Apellidos</label>
              <input type="text" class="form-control rounded-xl border-slate-200 py-2.5 font-bold shadow-sm" formControlName="apellido">
            </div>
            <div class="col-md-6">
              <label class="text-[10px] font-black text-slate-400 uppercase mb-2 d-block ms-1">DNI (8 dígitos)</label>
              <input type="text" class="form-control rounded-xl border-slate-200 py-2.5 font-bold shadow-sm" formControlName="dni" maxlength="8">
            </div>
            <div class="col-md-6">
              <label class="text-[10px] font-black text-slate-400 uppercase mb-2 d-block ms-1">Teléfono</label>
              <input type="text" class="form-control rounded-xl border-slate-200 py-2.5 font-bold shadow-sm" formControlName="telefono">
            </div>
            
            <div class="col-12 mt-4 pt-3 border-top">
              <label class="text-[10px] font-black text-primary uppercase mb-2 d-block ms-1">Vincular con Cuenta de Usuario</label>
              <div class="input-group overflow-hidden rounded-xl border border-slate-200 shadow-sm focus-within:ring-2 focus-within:ring-primary/20 transition-all bg-white">
                <span class="input-group-text bg-transparent border-0 ps-3"><i class="bi bi-envelope-at text-slate-400"></i></span>
                <input type="text" class="form-control border-0 py-2.5 font-bold text-slate-700 shadow-none" 
                       [value]="empleadoForm.get('usuarioEmail')?.value || 'Ningún usuario seleccionado'" readonly>
                <button type="button" class="btn btn-primary px-4 font-black text-[10px] uppercase border-0" (click)="abrirSubModalUsuario()">
                  <i class="bi bi-link-45deg me-1"></i> Vincular
                </button>
              </div>
            </div>

            <div class="col-12 mt-4">
              <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-link text-slate-400 font-bold text-decoration-none text-[11px] uppercase tracking-widest" (click)="cerrarTodo()">Cancelar</button>
                <button type="submit" class="btn btn-primary px-5 py-3 rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl shadow-primary/20" [disabled]="empleadoForm.invalid">
                  {{ editMode ? 'Actualizar' : 'Registrar' }} Empleado
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="usuarioSubModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-md">
    <div class="modal-content border-0 shadow-2xl rounded-[2rem]">
      <div class="modal-header border-0 p-4">
        <h5 class="font-black uppercase tracking-tight text-primary mb-0">Seleccionar Usuario</h5>
        <button type="button" class="btn-close shadow-none" (click)="cerrarSubModalYVolver()"></button>
      </div>
      <div class="modal-body p-4 pt-0">
        <input type="text" class="form-control rounded-xl border-slate-200 mb-3 text-sm font-medium py-2.5" 
               placeholder="Filtrar por email..." [(ngModel)]="terminoBusquedaUsuario" (input)="filtrarUsuariosModal()">
        
        <div class="list-group list-group-flush rounded-xl border border-slate-100 overflow-hidden shadow-sm overflow-y-auto" style="max-height: 300px;">
          <button *ngFor="let u of usuariosFiltrados" type="button" 
                  class="list-group-item list-group-item-action py-3 border-slate-50 d-flex justify-content-between align-items-center"
                  (click)="seleccionarUsuario(u)">
            <div>
              <div class="font-bold text-slate-700 text-sm">{{ u.email }}</div>
              <div class="text-[9px] font-black text-slate-400 uppercase tracking-widest mt-1">{{ u.rol }}</div>
            </div>
            <i class="bi bi-chevron-right text-primary"></i>
          </button>
          <div *ngIf="usuariosFiltrados.length === 0" class="p-4 text-center text-muted small italic">No hay usuarios disponibles</div>
        </div>
      </div>
    </div>
  </div>
</div>