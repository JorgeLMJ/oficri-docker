<div class="container-fluid animate-in fade-in duration-700">
  
  <header class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-5 gap-3">
    <div>
      <h2 class="text-primary font-black tracking-tighter mb-1 d-flex align-items-center">
        <span class="p-2 bg-primary/10 rounded-xl me-3">
          <i class="bi bi-journal-text text-primary"></i>
        </span>
        BITÁCORA DE AUDITORÍA
      </h2>
      <p class="text-slate-500 small font-medium ps-1 mb-0">
        Control de seguridad del sistema OFICRI
      </p>
    </div>
    
    <div class="bg-white px-4 py-2 rounded-2xl shadow-sm border border-slate-200">
      <span class="text-slate-400 font-black text-[10px] uppercase tracking-widest d-block">Registros Totales</span>
      <span class="text-primary font-black fs-5">{{ auditorias.length }}</span>
    </div>
  </header>

  <div *ngIf="loading" class="text-center py-10">
    <div class="spinner-grow text-primary mb-3" role="status"></div>
    <h6 class="text-slate-400 font-black text-[10px] uppercase tracking-[0.3em]">Sincronizando registros...</h6>
  </div>

  <ng-container *ngIf="!loading && auditorias.length > 0">
    
    <div class="table-responsive shadow-xl rounded-[2rem] border-0 bg-white overflow-hidden d-none d-md-block">
      <table class="table table-hover align-middle mb-0">
        <thead>
          <tr class="bg-slate-50 border-bottom border-slate-100">
            <th class="ps-4 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest">Usuario</th>
            <th class="py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center">Acción</th>
            <th class="py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center">Tipo</th>
            <th class="py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center">Referencia</th>
            <th class="py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest">Fecha y Hora</th>
            <th class="pe-4 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest text-end">Detalles</th>
          </tr>
        </thead>
        <tbody class="text-sm border-0 font-medium">
          <tr *ngFor="let a of paginatedAuditorias" class="transition-colors hover:bg-blue-50/30 border-bottom border-slate-50">
            <td class="ps-4 py-3">
              <span class="font-black text-slate-700 uppercase tracking-tighter">{{ a.nombreUsuario }}</span>
            </td>
            <td class="text-center">
              <span class="px-2 py-1 rounded-lg bg-slate-100 text-slate-600 font-black text-[9px] uppercase border border-slate-200">
                {{ a.accion }}
              </span>
            </td>
            <td class="text-center">
              <div [ngClass]="{
                'bg-emerald-50 text-emerald-600 border-emerald-100': a.tipoAccion === 'CREATE',
                'bg-amber-50 text-amber-600 border-amber-100': a.tipoAccion === 'UPDATE',
                'bg-rose-50 text-rose-600 border-rose-100': a.tipoAccion === 'DELETE'
              }" class="px-2 py-1 rounded-lg border font-black text-[9px] uppercase tracking-widest">
                {{ a.tipoAccion }}
              </div>
            </td>
            <td class="text-center">
              <span class="badge bg-blue-50 text-blue-600 font-mono border border-blue-100">#{{ a.entidadId }}</span>
            </td>
            <td>
              <div class="d-flex flex-column text-[11px]">
                <span class="font-bold text-slate-700">{{ a.fecha | date:'dd MMM, yyyy' }}</span>
                <span class="text-slate-400">{{ a.fecha | date:'HH:mm:ss' }}</span>
              </div>
            </td>
            <td class="pe-4 text-end">
              <button class="btn btn-primary btn-sm rounded-xl px-3 font-black text-[10px] uppercase shadow-sm" (click)="verDetalles(a.detalles)">
                Data
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-md-none space-y-4">
      <div *ngFor="let a of paginatedAuditorias" class="bg-white p-4 rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden position-relative">
        <div class="position-absolute start-0 top-0 bottom-0 w-2" [ngClass]="{
          'bg-emerald-500': a.tipoAccion === 'CREATE',
          'bg-amber-500': a.tipoAccion === 'UPDATE',
          'bg-rose-500': a.tipoAccion === 'DELETE'
        }"></div>

        <div class="d-flex justify-content-between align-items-start mb-3">
          <div>
            <h6 class="font-black text-slate-800 uppercase mb-0 tracking-tighter">{{ a.nombreUsuario }}</h6>
            <span class="text-[10px] font-bold text-slate-400">{{ a.fecha | date:'dd/MM/yyyy HH:mm:ss' }}</span>
          </div>
          <span class="badge bg-slate-100 text-slate-600 font-black text-[9px] border border-slate-200 px-2 py-1 rounded-lg uppercase">
            {{ a.accion }}
          </span>
        </div>

        <div class="row g-2 mb-3 bg-slate-50 p-2 rounded-2xl border border-slate-100">
          <div class="col-6">
            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest d-block">Entidad</label>
            <span class="text-xs font-bold text-slate-700">{{ a.entidad }}</span>
          </div>
          <div class="col-6 text-end">
            <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest d-block">ID Registro</label>
            <span class="badge bg-blue-100 text-blue-600 rounded-pill font-mono">#{{ a.entidadId }}</span>
          </div>
        </div>

        <button class="btn btn-primary w-100 rounded-xl font-black text-[10px] uppercase py-2.5 shadow-lg shadow-primary/20" (click)="verDetalles(a.detalles)">
          <i class="bi bi-eye-fill me-2"></i> Ver Detalles Técnicos
        </button>
      </div>
    </div>

    <footer class="mt-5 d-flex justify-content-center">
      <nav class="bg-white p-2 rounded-2xl shadow-xl border border-slate-100">
        <ul class="pagination mb-0 border-0 gap-1">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link border-0 rounded-xl w-10 h-10 d-flex align-items-center justify-center transition-all hover:bg-slate-100" (click)="goToPage(currentPage - 1)">
              <i class="bi bi-chevron-left text-primary"></i>
            </button>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
            <button class="page-link border-0 rounded-xl w-10 h-10 d-flex align-items-center justify-center font-black transition-all" 
                    [ngClass]="page === currentPage ? 'bg-primary text-white shadow-md shadow-primary/30' : 'text-slate-500 bg-transparent hover:bg-slate-50'" 
                    (click)="goToPage(page)">
              {{ page }}
            </button>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link border-0 rounded-xl w-10 h-10 d-flex align-items-center justify-center transition-all hover:bg-slate-100" (click)="goToPage(currentPage + 1)">
              <i class="bi bi-chevron-right text-primary"></i>
            </button>
          </li>
        </ul>
      </nav>
    </footer>

  </ng-container>

  <div *ngIf="!loading && auditorias.length === 0" class="text-center py-10 animate-in zoom-in duration-500">
    <div class="bg-slate-50 d-inline-block p-5 rounded-[3.5rem] border border-dashed border-slate-200 mb-4 shadow-sm">
      <i class="bi bi-journal-x display-1 text-slate-200"></i>
    </div>
    <h5 class="text-slate-600 font-black tracking-tight">Sin registros de actividad</h5>
    <p class="text-slate-400 font-medium small mt-2">La bitácora se encuentra vacía por el momento.</p>
  </div>

</div>