<div class="container mt-4 animate-in fade-in duration-500">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <button class="bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-2.5 rounded-xl shadow-lg shadow-emerald-200 transition-all flex items-center font-black text-xs uppercase tracking-widest" 
            (click)="nuevoUsuario()">
      <i class="bi bi-person-plus me-2 text-lg"></i> Nuevo Usuario
    </button>

    <div class="text-end">
      <h2 class="text-primary font-black tracking-tight mb-0">
        GESTIÓN DE USUARIOS <i class="bi bi-person-gear ms-2"></i>
      </h2>
      <p class="text-muted small mb-0 font-medium">Control de accesos y roles del sistema</p>
    </div>
  </div>

  <div class="input-group mb-4 shadow-sm rounded-2xl overflow-hidden border border-slate-200">
    <span class="input-group-text bg-white border-0 text-slate-400 ps-4">
      <i class="bi bi-search"></i>
    </span>
    <input type="text" class="form-control border-0 py-3 text-sm focus:ring-0 shadow-none bg-white" 
           placeholder="Buscar por nombre, email o rol..."
           [(ngModel)]="terminoBusqueda" (input)="filtrarUsuarios()">
  </div>

  <div class="d-md-none space-y-3">
    <div class="card shadow-sm border-0 rounded-2xl" *ngFor="let usuario of usuariosPaginados">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <h6 class="font-black text-primary mb-0">{{ usuario.nombre }}</h6>
          <span class="badge bg-secondary text-[10px] uppercase">{{ usuario.rol }}</span>
        </div>
        <p class="text-muted small mb-3">{{ usuario.email }}</p>
        <div class="d-flex gap-2 border-t pt-3">
          <button class="btn btn-sm btn-warning flex-1 rounded-lg font-bold" (click)="editarUsuario(usuario)">
            <i class="bi bi-pencil-square me-1"></i> Editar
          </button>
          <button class="btn btn-sm btn-danger flex-1 rounded-lg font-bold" (click)="eliminarUsuario(usuario.id!)">
            <i class="bi bi-trash me-1"></i> Borrar
          </button>
        </div>
      </div>
    </div>
    <div *ngIf="usuariosFiltrados.length === 0" class="text-center text-muted py-3 italic">
      No se encontraron resultados
    </div>
  </div>

  <div class="table-responsive shadow-sm rounded-3xl border d-none d-md-block bg-white overflow-hidden">
    <table class="table table-hover align-middle mb-0">
      <thead>
        <tr class="bg-slate-100 border-bottom border-slate-300">
          <th class="ps-4 py-3.5 text-[11px] font-black text-black uppercase tracking-[0.25em] border-0 rounded-tl-3xl relative">
            ID
            <div class="absolute right-0 top-1/4 h-1/2 w-[1px] bg-slate-300"></div>
          </th>
          <th class="py-3.5 text-[11px] font-black text-black uppercase tracking-[0.25em] border-0 relative">
            Nombre Completo
            <div class="absolute right-0 top-1/4 h-1/2 w-[1px] bg-slate-300"></div>
          </th>
          <th class="py-3.5 text-[11px] font-black text-black uppercase tracking-[0.25em] border-0 relative">
            Email de Acceso
            <div class="absolute right-0 top-1/4 h-1/2 w-[1px] bg-slate-300"></div>
          </th>
          <th class="py-3.5 text-[11px] font-black text-black uppercase tracking-[0.25em] border-0 text-center relative">
            Rol
            <div class="absolute right-0 top-1/4 h-1/2 w-[1px] bg-slate-300"></div>
          </th>
          <th class="pe-4 py-3.5 text-[11px] font-black text-black uppercase tracking-[0.25em] border-0 text-end rounded-tr-3xl">
            Acciones
          </th>
        </tr>
      </thead>
      
      <tbody class="text-sm border-top-0">
        <tr *ngFor="let usuario of usuariosPaginados" class="hover:bg-blue-50/40 transition-colors border-bottom border-slate-100">
          <td class="ps-4 font-bold text-slate-400">#{{ usuario.id }}</td>
          <td>
            <div class="d-flex align-items-center">
              <div class="h-9 w-9 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center font-black text-xs me-3 border border-blue-200">
                {{ usuario.nombre.charAt(0).toUpperCase() }}
              </div>
              <span class="font-bold text-slate-700">{{ usuario.nombre }}</span>
            </div>
          </td>
          <td class="text-muted font-medium">{{ usuario.email }}</td>
          <td class="text-center">
            <span class="px-3 py-1 rounded-lg text-[10px] font-black bg-slate-100 text-slate-600 border border-slate-200 uppercase tracking-tighter">
              {{ usuario.rol }}
            </span>
          </td>
          <td class="pe-4 text-end">
            <div class="d-flex justify-content-end gap-1">
              <button (click)="editarUsuario(usuario)" class="p-2 text-amber-500 hover:bg-amber-50 rounded-xl transition-all border-0 bg-transparent shadow-none">
                <i class="bi bi-pencil-square fs-5"></i>
              </button>
              <button (click)="eliminarUsuario(usuario.id!)" class="p-2 text-red-500 hover:bg-red-50 rounded-xl transition-all border-0 bg-transparent shadow-none">
                <i class="bi bi-trash fs-5"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-center mt-5">
    <nav aria-label="Paginación" class="bg-white p-1 rounded-2xl border border-slate-200 shadow-sm">
      <ul class="pagination pagination-sm mb-0 border-0">
        <li class="page-item" [class.disabled]="paginaActual === 1">
          <button class="page-link border-0 rounded-xl bg-transparent text-slate-500 font-bold hover:bg-slate-50 px-3" (click)="paginaAnterior()">Anterior</button>
        </li>
        <li class="page-item mx-1" *ngFor="let num of getPaginasVisibles()" [class.active]="num === paginaActual">
          <button class="page-link border-0 rounded-xl font-black w-8 h-8 d-flex align-items-center justify-center transition-all"
                  [ngClass]="num === paginaActual ? 'bg-blue-600 text-white shadow-md' : 'bg-transparent text-slate-600 hover:bg-slate-100'"
                  (click)="irAPagina(num)">{{ num }}</button>
        </li>
        <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
          <button class="page-link border-0 rounded-xl bg-transparent text-slate-500 font-bold hover:bg-slate-50 px-3" (click)="paginaSiguiente()">Posterior</button>
        </li>
      </ul>
    </nav>
  </div>
</div>

<div class="modal fade" id="usuarioModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content shadow-2xl border-0 rounded-[2rem] overflow-hidden">
      <div class="modal-header bg-primary text-white p-4">
        <h5 class="modal-title font-black uppercase tracking-tight">
          {{ usuarioSeleccionado?.id ? '✏️ Editar Usuario' : '➕ Nuevo Usuario' }}
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4 bg-white">
        <form [formGroup]="usuarioForm" (ngSubmit)="guardarUsuario()">
          <div class="row g-4">
            <div class="col-md-6">
              <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-2 block">Nombre</label>
              <input type="text" class="form-control rounded-xl border-slate-200 py-2.5" formControlName="nombre" required>
            </div>
            <div class="col-md-6">
              <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-2 block">Email</label>
              <input type="email" class="form-control rounded-xl border-slate-200 py-2.5" formControlName="email" required>
            </div>
            <div class="col-md-6">
              <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-2 block">Contraseña</label>
              <input type="password" class="form-control rounded-xl border-slate-200 py-2.5" formControlName="password" [required]="!usuarioSeleccionado">
              <small *ngIf="usuarioSeleccionado" class="text-amber-500 text-[10px] font-bold mt-1 block">
                (Dejar vacío si no deseas cambiarla)
              </small>
            </div>
            <div class="col-md-6">
              <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1 mb-2 block">Rol del Sistema</label>
              <select class="form-select rounded-xl border-slate-200 py-2.5 font-bold text-slate-600" formControlName="rol" required>
                <option value="Auxiliar de Toxicologia">Auxiliar de Toxicologia</option>
                <option value="Auxiliar de Dosaje">Auxiliar de Dosaje</option>
                <option value="Quimico Farmaceutico">Quimico Farmaceutico</option>
              </select>
            </div>
          </div>
          <div class="modal-footer border-0 mt-4 px-0 pb-0">
            <button type="button" class="btn btn-link text-slate-400 font-bold text-decoration-none" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="bg-blue-900 hover:bg-blue-800 text-white px-8 py-2.5 rounded-xl shadow-lg font-black text-xs uppercase tracking-widest transition-all" [disabled]="usuarioForm.invalid">
              {{ usuarioSeleccionado?.id ? 'Actualizar' : 'Guardar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>